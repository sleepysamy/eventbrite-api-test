"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.httpPost = exports.httpGet = exports.setHttpsRequest = void 0;
const https_1 = __importDefault(require("https"));
let httpsRequest = https_1.default.request;
exports.setHttpsRequest = (request) => {
    httpsRequest = request;
};
const agent = new https_1.default.Agent({ keepAlive: true });
const request = (method, params) => new Promise((resolve, reject) => {
    const { body, headers, hostname, path } = params;
    const req = httpsRequest({ agent, headers, hostname, method, path }, res => {
        const chunks = [];
        res.on('data', chunk => {
            chunks.push(chunk);
        });
        res.on('end', () => {
            const { statusCode } = res;
            resolve({ statusCode, body: Buffer.concat(chunks).toString() });
        });
        res.on('error', e => {
            reject(e);
        });
    });
    req.on('error', e => {
        reject(e);
    });
    if (body) {
        req.write(JSON.stringify(body));
    }
    req.end();
});
exports.httpGet = (params) => request('GET', params);
exports.httpPost = (params) => request('POST', params);
